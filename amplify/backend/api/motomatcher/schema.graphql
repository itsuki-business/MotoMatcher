# MotoMatcher GraphQL Schema

enum UserType {
  client
  photographer
}

type User @model @auth(rules: [
  { allow: owner, operations: [create, read, update, delete] },
  { allow: private, operations: [read] }
]) {
  id: ID!
  email: String!
  nickname: String
  user_type: UserType
  prefecture: String
  bike_maker: String
  bike_model: String
  bio: String
  profile_image: String
  genres: [String]
  instagram_url: String
  twitter_url: String
  website_url: String
  minimum_rate: Int
  rate_details: String
  owner: String @auth(rules: [{ allow: owner, operations: [read, delete] }])
  
  portfolioItems: [Portfolio] @connection(keyName: "byPhotographer", fields: ["id"])
  conversationsAsBiker: [Conversation] @connection(keyName: "byBiker", fields: ["id"])
  conversationsAsPhotographer: [Conversation] @connection(keyName: "byPhotographer", fields: ["id"])
  reviewsGiven: [Review] @connection(keyName: "byReviewer", fields: ["id"])
  reviewsReceived: [Review] @connection(keyName: "byReviewee", fields: ["id"])
  sentMessages: [Message] @connection(keyName: "bySender", fields: ["id"])
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Portfolio @model @auth(rules: [
  { allow: owner, ownerField: "owner" },
  { allow: private, operations: [read] }
]) @key(name: "byPhotographer", fields: ["photographer_id", "createdAt"], queryField: "portfoliosByPhotographer") {
  id: ID!
  photographer_id: ID!
  image_key: String!
  title: String
  description: String
  owner: String
  photographer: User @connection(fields: ["photographer_id"])
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Conversation @model @auth(rules: [
  { allow: owner, ownerField: "biker_id" },
  { allow: owner, ownerField: "photographer_id" }
]) @key(name: "byBiker", fields: ["biker_id", "last_message_at"], queryField: "conversationsByBiker") @key(name: "byPhotographer", fields: ["photographer_id", "last_message_at"], queryField: "conversationsByPhotographer") {
  id: ID!
  biker_id: ID!
  photographer_id: ID!
  biker_name: String
  photographer_name: String
  last_message: String
  last_message_at: AWSDateTime
  status: String
  
  biker: User @connection(fields: ["biker_id"])
  photographer: User @connection(fields: ["photographer_id"])
  messages: [Message] @connection(keyName: "byConversation", fields: ["id"])
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Message @model @auth(rules: [
  { allow: owner, ownerField: "sender_id" },
  { allow: private, operations: [read] }
]) @key(name: "byConversation", fields: ["conversationID", "createdAt"], queryField: "messagesByConversation") @key(name: "bySender", fields: ["sender_id", "createdAt"]) {
  id: ID!
  conversationID: ID!
  sender_id: ID!
  content: String
  media_key: String
  media_type: String
  is_read: Boolean
  
  conversation: Conversation @connection(fields: ["conversationID"])
  sender: User @connection(fields: ["sender_id"])
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Review @model @auth(rules: [
  { allow: owner, ownerField: "reviewer_id" },
  { allow: private, operations: [read] }
]) @key(name: "byReviewer", fields: ["reviewer_id", "createdAt"]) @key(name: "byReviewee", fields: ["reviewee_id", "createdAt"], queryField: "reviewsByReviewee") {
  id: ID!
  reviewer_id: ID!
  reviewee_id: ID!
  conversation_id: ID
  rating: Int!
  comment: String
  
  reviewer: User @connection(fields: ["reviewer_id"])
  reviewee: User @connection(fields: ["reviewee_id"])
  
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}